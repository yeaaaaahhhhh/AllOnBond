## Bond Math (ACT/365, Fixed & Zero, KRW/USD, 세전/세후)

### 표기
- 면가(face value)=100 기준 가격을 사용. `cleanPrice = 100`이면 액면가.
- 연 쿠폰횟수 `f`(fixed: 1/2/4/12), 제로는 0.
- Day count: `ACT/365`.
- 통화는 계산식에 직접 영향 없음(KRW/USD는 표기·세율·환산에만 영향).

### 경과이자(Accrued Interest)
- `accrued = couponRate * faceValue * (actualDaysSinceLastCoupon / 365) * (1/f)`
- 단, 고정 쿠폰의 쿠폰액 `C = couponRate * faceValue / f`
- `dirtyPrice = cleanPrice + accrued`

### 쿠폰 스케줄
- 기준일과 만기일, 빈도 `f`로 쿠폰 지급일 열거. 
- 첫/마지막 스텁 없음(단순화). (향후 스텁 지원 가능)

### 가격 ↔ YTM (고정 쿠폰)
- 가격(면가=100 기준):
  \[ P = \sum_{k=1..N} \frac{C}{(1 + y/f)^k} + \frac{FV}{(1 + y/f)^N} \]
  - `C = couponRate * FV / f`, `FV = 100`
- YTM은 위 식을 `y`에 대해 수치해로 풉니다.
  - 초기값: `y0 = max(1e-6, couponRate)`
  - 방법: 뉴턴-랩슨(도함수 포함) + 실패 시 이분법 fallback
  - 수렴 기준: |Δy| < 1e-8 또는 가격 오차 < 1e-8

### 가격 ↔ 수익률 (제로 쿠폰)
- 제로: \( P = \frac{FV}{(1 + y)^{t}} \), 여기서 \(t = days/365\)
- `y = (FV/P)^{1/t} - 1`

### 예금 환산 수익률(EAR/월복리/표시 APR)
- 명목 YTM `y`와 빈도 `f`로 연등가수익률(EAR): `EAR = (1 + y/f)^f - 1`
- 월복리 예금 등가 월수익률: `r_m = (1 + EAR)^(1/12) - 1`
- 표기용 연 APR 근사: `APR_eq ≈ 12 * r_m`

### 세전/세후 수익률
- 가정(한국 기준 예시, 변경 가능):
  - 이자소득세 14% + 지방세 1.4% = 15.4% 원천징수(쿠폰/할인이자 모두)
- 쿠폰채 세후 현금흐름:
  - 각 쿠폰 \(C\) 지급 시 \(C_{net} = C * (1 - 0.154)\)
  - 만기 상환액 \(FV\)는 원금 비과세로 가정, 할인채 이자분은 세율 적용
- 제로채 세후: \( FV - P = 이자 \Rightarrow 이자_{net} = (FV - P) * (1 - 0.154) \)
- 세후 YTM: 위의 세후 현금흐름을 사용해 동일한 방식으로 역산

### 통화(KRW/USD)
- 계산 로직은 동일. 통화 토글은
  - 표기 통화, 서식(천단위, 기호) 변경
  - 세율/수수료 가정 분기 가능(현 단계에서는 동일 세율 적용)

### 수치 안정성 메모
- `cleanPrice`가 0 또는 매우 낮으면 제로채 공식을 사용
- 고정 쿠폰에서 `y ≈ -f` 근처 발산 주의 → 이분법 구간 [y_min, y_max]를 넓게 설정(예: [-0.99, 1.0])
- 만기 매우 짧을 때 `t -> 0` 처리(가격≈면가, 경과이자 보정)

### 출력 항목(계산기)
- 현금흐름표: 지급일, 쿠폰 세전/세후, 만기 상환액
- 경과이자, 더티/클린 가격
- YTM(세전/세후), EAR, 월복리 등가 APR
- 예금 환산 수익률 산출 과정(툴팁/팝오버에 단계별 수식 표시)
